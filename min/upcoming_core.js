var upcoming=function(){function w(){return function(){}}function e(n,t,i){dust.render(n,t,function(n,t){n!==null?f(n):i.innerHTML=t})}function k(){return b++}function l(){for(var t=arguments[0],i,n=0;n<arguments.length-1;n++)i=new RegExp("\\{"+n+"\\}","gm"),t=t.replace(i,arguments[n+1]);return t}function t(){f(l.apply(this,arguments))}function f(n){alert(n)}function d(o){var w,p,b;if(o===null){f(n.err_config_required);return}if(!et(o.id)){t(n.err_format_config_id_invalid,o.id);return}o=o||{id:null,evts:null,prog:null},o.evts=o.evts||{},o.prog=o.prog||{},o.prog.bdr=o.prog.bdr||{},o.prog.bar=o.prog.bar||{},o.prog.lbl=o.prog.lbl||{};var k=o.id||n.default_div_id,v=h[o.id]={id:k,max_results:o.max_results||5,expectedFeeds:[],ui:{div:null,css:o.css||"upcoming",prog:{id:k+(o.prog.idSuffix||"_prog"),div:null,css:o.prog.css||"prog",msgs:{},step:0,steps:0,bdr:{id:k+(o.prog.bdr.idSuffix||"_prog_bdr"),css:o.prog.bdr.css||"bdr",div:null},bar:{id:k+(o.prog.bar.idSuffix||"_prog_bar"),css:o.prog.bar.css||"bar",div:null},lbl:{id:k+(o.prog.lbl.idSuffix||"_prog_lbl"),css:o.prog.lbl.css||"lbl",div:null}},evts:{id:k+(o.prog.idSuffix||"_evts"),div:null,css:o.evts.css||"evts"}},evts:[],evtCats:ft(moment())},d=v.ui,y=v.ui.prog,nt=v.ui.evts;if(r(v,"init",n.prog_init),r(v,"sort",n.prog_sort),r(v,"render",n.prog_render),d.div=document.getElementById(v.id),d.div===null){t(n.err_format_cannot_render,v.id);return}if(d.div.setAttribute("class",d.css),e("upcoming_ui",d,d.div),y.div=document.getElementById(y.id),y.div===null){t(n.err_format_cannot_render,y.id);return}if(y.lbl.div=document.getElementById(y.lbl.id),y.lbl.div===null){t(n.err_format_cannot_render,y.lbl.id);return}if(y.bar.div=document.getElementById(y.bar.id),y.bar.div===null){t(n.err_format_cannot_render,y.bar.id);return}if(y.bdr.div=document.getElementById(y.bdr.id),y.bdr.div===null){t(n.err_format_cannot_render,y.bdr.id);return}if(nt.div=document.getElementById(nt.id),nt.div===null){t(n.err_format_cannot_render,nt.id);return}for(w=0;w<o.feeds.length;w++)p={id:o.feeds[w]+"_"+v.id,feed:o.feeds[w],instance:v.id,uri:"http://www.google.com/calendar/feeds/"+encodeURIComponent(o.feeds[w])+"/public/full"},v.expectedFeeds[p.uri]=p,r(v,p.id,l(n.prog_process_feed,w+1)),p.uri in i?(b=i[p.uri],b.expectedInstances[v.id]=p,b.data!==null&&a(null,p.uri)):(s++,b=i[p.uri]={data:null,expectedInstances:{},callback:"feed"+s},c[b.callback]=g(p.uri),b.expectedInstances[v.id]=p,document.write("<script type='text/javascript' src='"+p.uri+"?alt=json-in-script&callback=upcoming.callbacks."+encodeURIComponent(b.callback)+"&orderby=starttime&max-results="+encodeURIComponent(v.max_results)+"&singleevents=true&sortorder=ascending&futureevents=true'><\/script>"));u(v,"init")}function g(n){return function(t){a(t,n)}}function nt(n){var i,t={title:n.title.$t||null,where:n.gd$where[0].valueString||null,description:n.content.$t||null,startMoment:p(n.gd$when[0].startTime)||moment(),startTime:n.gd$when[0].startTime,endMoment:p(n.gd$when[0].endTime)||moment(n.startMoment),endTime:n.gd$when[0].endTime,createdBy:n.author[0].name.$t||null,id:k()};for(t.duration=moment.duration(t.endMoment.diff(t.startMoment)),t.whereHref=y(t.where)?t.where:"http://maps.google.com/maps?hl=en&q="+encodeURI(t.where),t.href=null,i=0;i<n.link.length;i++)n.link[i].type=="text/html"&&n.link[i].type=="alternate"&&(t.href=encodeURI(n.link[i].href));return t.titleHref=y(t.title)?t.title:t.href,t.when=t.duration.asMilliseconds()===0?t.startMoment.calendar():t.startMoment.calendar()+" - "+t.duration.humanize(),t}function tt(n){var i=[],t;if(n!==null)for(i[n.length-1]=null,t=0;t<n.length;t++)i[t]=nt(n[t]);return i}function a(n,t){var f=i[t],o,c,l,r,s,y,e,a,v;f.evts=f.evts||tt(n.feed.entry);for(a in f.expectedInstances){for(s=f.expectedInstances[a],r=h[s.instance],u(r,s.id),o=r.evts,c=o.length,l=f.evts.length,o[c+l-1]=null,e=0;e<l;e++)o[c+e]=f.evts[e];delete r.expectedFeeds[s.uri],delete f.expectedInstances[a];for(v in r.expectedFeeds)if(r.expectedFeeds.hasOwnProperty(v))return;rt(r),u(r,"render")}}function r(n,t,i){var r=n.ui.prog;r.msgs[t]=i,r.steps++}function u(n,t){var i=n.ui.prog,r;i.step===0&&(n.ui.prog.div.style.display="block"),r=i.msgs[t],i.step++,i.step>=i.steps?n.ui.prog.div.style.display="none":it(i,r,100*i.step/i.steps)}function it(n,t,i){i>=0?(n.bdr.div.style.display="block",n.bar.div.style.width=i+"%"):n.bdr.div.style.display="none",t!==null&&(n.lbl.div.innerHtml=t)}function rt(t){function l(n,t){return n.startMoment.diff(t.startMoment)}var o=t.evts,r,f,s,i,h,c;for(o.sort(l),r=t.evtCats,s=0,u(t,"sort"),i=0;i<o.length;i++)for(c=o[i],f=s;f<r.length;f++)if(h=r[f],ut(c,h)){s=i,h.evts.push(c);break}e("upcoming_evtcats",{res:n,evtCats:r},t.ui.evts.div)}function ut(n,t){if(t.start===null&&t.end===null)return!1;var i=t.start.diff(n.startMoment)<=0,r=t.end.diff(n.startMoment)>0;return i&&r}function v(n){return n.startMonth=n.start.format("MMM")+" ",n.endMonth=n.end.format("MMM")+" ",n.range=n.startMonth===n.endMonth?n.startMonth+n.start.format("Do")+" - "+n.end.format("Do"):n.startMonth+n.start.format("Do")+" - "+n.endMonth+n.end.format("Do"),n}function ft(t){var i=moment(t).sod(),c=moment(t).eod(),f=moment(i).subtract("days",i.day()),e=moment(f).add("weeks",1),o=moment(e),l=moment(o).add("week",1),r=moment(t).startOf("month"),s=moment(r).add("months",1),u=moment(s),a=moment(u).add("months",1),h=moment(t).startOf("year"),y=moment(t).endOf("year");return[{start:i,end:c,div:null,evts:[],dateFormat:n.time_format,timeFormat:n.time_format,multiDateFormat:n.date_format,caption:n.event_cat_today,range:i.format(n.date_format)},v({start:f,end:e,div:null,evts:[],dateFormat:n.date_format,timeFormat:n.time_format,multiDateFormat:n.date_format,caption:n.event_cat_this_week}),v({start:o,end:l,div:null,evts:[],dateFormat:n.date_format,timeFormat:n.time_format,multiDateFormat:n.date_format,caption:n.event_cat_next_week}),{start:r,end:s,div:null,evts:[],dateFormat:n.date_format,timeFormat:n.time_format,multiDateFormat:n.date_format,caption:n.event_cat_this_month,range:r.format("MMM YYYY")},{start:u,end:a,div:null,evts:[],dateFormat:n.date_format,timeFormat:n.time_format,multiDateFormat:n.date_format,caption:n.event_cat_next_month,range:u.format("MMM YYYY")},{start:h,end:y,div:null,evts:[],dateFormat:n.date_format,timeFormat:n.time_format,multiDateFormat:n.date_format,caption:n.event_cat_this_year,range:h.format("YYYY")},{start:null,end:null,div:null,evts:[],dateFormat:n.date_format,timeFormat:n.time_format,multiDateFormat:n.date_format,caption:n.event_cat_upcoming,range:""}]}function y(n){var t=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return t.test(n)}function et(n){var t=/[A-Za-z][A-Za-z0-9_:.]*/;return t.test(n)}function ot(n){var t,i;t=document.getElementById("evt_dtl_"+n),i=document.getElementById("evt_tgl_"+n),t.style.display=="none"?(t.style.display="block",i.innerHTML="&minus;"):t.style.display=="block"&&(t.style.display="none",i.innerHTML="+")}function p(n){function t(n){var t=i.match(new RegExp("^"+n));return t?(i=i.substring(t[0].length),t[0]):""}var i=n,f,e,o,c,r,l,u,a;if(typeof n=="undefined")return n;f=0,e=t("\\d{4}"),t("-?"),o=t("\\d{2}"),t("-?");var v=t("\\d{2}"),y=t("T"),s=0,h=0;return y=="T"&&(s=t("\\d{2}"),t(":?"),h=t("\\d{2}"),t("(:\\d{2})?(\\.\\d{3})?"),c=t("Z"),c!="Z"&&(r=t("[\\+\\-]"),r!==""&&(l=t("\\d{2}"),t(":?"),u=t("\\d{2}"),f=(r==="-"?1:-1)*(Number(l)*60+(u===""?0:Number(u)))))),a=new Date(e,o-1,v,s,h),moment(a)}window.console||function(){var t=["log","debug","info","warn","error","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"],n;for(window.console={},n=0;n<t.length;++n)window.console[t[n]]=w()}();var o={},s=0,b=0,n={default_div_id:"upcoming",prog_init:"Initializing...",prog_process_feed:"Processing Feed {0}...",prog_sort:"Sorting Events...",prog_render:"Rendering Events...",prog_no_events_found:"No Events Found.",event_cat_today:"Today",event_cat_this_week:"This Week",event_cat_next_week:"Next Week",event_cat_this_month:"This Month",event_cat_next_month:"Next Month",event_cat_this_year:"This Year",event_cat_upcoming:"Upcoming",time_format:"LT",date_format:"LL",err_format_cannot_render:"Upcoming.js: Error. Cannot render to element '{0}'. Does this id exist?",err_format_config_id_invalid:"Upcoming.js: Error. Cannot render to element '{0}'. id not supported.",err_config_required:"Upcoming.js: Error. Cannot render without configuration.",last:"placeholder"};o.EN=o["EN-us"]=n;var h={},i={},c={};return{render:d,toggleEvtDetail:ot,callbacks:c}}()